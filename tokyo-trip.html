<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>東京旅誌 - 極致美化版</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@600&family=Noto+Sans+TC:wght@400;700&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f8fafc; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        .timeline-container::before {
            content: ''; position: absolute; left: 27px; top: 0; bottom: 0; width: 2px; background: #f1f5f9; z-index: 0;
        }
        /* 隱藏原生時間輸入的圖示，讓畫面更乾淨 */
        input[type="time"]::-webkit-calendar-picker-indicator {
            background: transparent; bottom: 0; color: transparent; cursor: pointer; height: auto; left: 0; position: absolute; right: 0; top: 0; width: auto;
        }
        .list-move { transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1); }
    </style>
</head>
<body>
    <div id="app" class="max-w-md mx-auto min-h-screen flex flex-col bg-white shadow-2xl relative">
        
        <header class="bg-indigo-950 text-white p-6 pb-4 shrink-0 z-20 shadow-lg">
            <div class="flex justify-between items-center mb-4">
                <h1 class="text-xl font-bold tracking-tight">TOKYO 2025</h1>
                <button @click="addDay" class="text-xs bg-white/10 px-3 py-1.5 rounded-xl border border-white/20 active:scale-95 transition">＋天數</button>
            </div>
            <div class="flex gap-3 overflow-x-auto no-scrollbar">
                <button v-for="(day, index) in itineraryData" :key="index"
                    @click="currentDayIndex = index"
                    :class="['flex-none w-14 py-2 rounded-2xl text-xs font-bold transition-all', 
                    currentDayIndex === index ? 'bg-indigo-500 text-white shadow-lg' : 'bg-white/5 text-slate-400']">
                    D{{ index + 1 }}
                </button>
            </div>
        </header>

        <main class="flex-grow overflow-y-auto p-4 relative timeline-container bg-slate-50">
            <transition-group name="list" tag="div">
                <div v-for="(item, idx) in sortedItems" :key="item.id" class="relative z-10 mb-6">
                    
                    <div v-if="idx > 0" class="ml-14 -mt-2 mb-4 flex items-center gap-2">
                        <span :class="['text-[10px] font-bold px-2 py-0.5 rounded-full border', 
                            getGap(sortedItems[idx-1], item) < 0 ? 'bg-red-50 text-red-500 border-red-100' : 'bg-white text-slate-400 border-slate-100']">
                            {{ getGap(sortedItems[idx-1], item) < 0 ? '⚠️ 時間重疊' : 'Gap ' + formatMin(getGap(sortedItems[idx-1], item)) }}
                        </span>
                    </div>

                    <div class="flex gap-4">
                        <div class="w-10 pt-4 shrink-0 flex flex-col items-center">
                            <div class="w-3 h-3 rounded-full border-2 border-white shadow-sm ring-2"
                                 :class="item.category === 'activity' ? 'bg-indigo-500 ring-indigo-100' : 'bg-orange-400 ring-orange-100'"></div>
                            <span class="text-[10px] font-mono text-slate-400 mt-2">{{ item.start }}</span>
                        </div>

                        <div class="flex-grow bg-white rounded-[2rem] p-5 shadow-sm border border-slate-100 relative transition-transform active:scale-[0.98]">
                            
                            <div class="flex justify-between items-start mb-3">
                                <input v-model="item.title" class="font-bold text-slate-800 bg-transparent outline-none w-full text-lg placeholder-slate-200" placeholder="景點名稱...">
                                <button @click="removeItem(item.id)" class="text-slate-200 hover:text-red-400 transition"><i data-lucide="x-circle" class="w-5 h-5"></i></button>
                            </div>

                            <div class="flex items-center gap-2">
                                <div class="relative flex items-center gap-2 bg-slate-50 border border-slate-100 px-3 py-1.5 rounded-2xl group active:bg-indigo-50 transition-colors">
                                    <i data-lucide="clock" class="w-3.5 h-3.5 text-indigo-400"></i>
                                    <div class="flex flex-col">
                                        <span class="text-[8px] uppercase text-slate-400 font-black leading-none mb-0.5">Start</span>
                                        <input type="time" v-model="item.start" class="text-xs font-mono font-bold text-slate-700 bg-transparent outline-none cursor-pointer w-[60px]">
                                    </div>
                                    <div class="h-4 w-[1px] bg-slate-200 mx-1"></div>
                                    <div class="flex flex-col">
                                        <span class="text-[8px] uppercase text-slate-400 font-black leading-none mb-0.5">End</span>
                                        <input type="time" v-model="item.end" class="text-xs font-mono font-bold text-slate-700 bg-transparent outline-none cursor-pointer w-[60px]">
                                    </div>
                                </div>
                                
                                <select v-model="item.category" class="text-[10px] font-bold bg-slate-50 border border-slate-100 px-3 py-3 rounded-2xl outline-none appearance-none text-slate-500">
                                    <option value="activity">景點</option>
                                    <option value="transport">交通</option>
                                </select>
                            </div>

                            <div v-if="item.category === 'transport'" class="mt-3 flex flex-wrap gap-2">
                                <button v-for="mode in ['walk', 'taxi', 'metro', 'shinkansen']" :key="mode"
                                    @click="item.subType = mode"
                                    :class="item.subType === mode ? 'bg-orange-500 text-white' : 'bg-slate-50 text-slate-400'"
                                    class="text-[10px] px-3 py-1.5 rounded-full font-bold transition">
                                    {{ mode.toUpperCase() }}
                                </button>
                            </div>
                            
                            <textarea v-model="item.details" class="text-xs text-slate-400 bg-transparent w-full mt-4 resize-none outline-none border-t border-slate-50 pt-3" rows="1" placeholder="Add some notes..."></textarea>
                        </div>
                    </div>
                </div>
            </transition-group>
            <div class="h-32"></div>
        </main>

        <button @click="addItem" class="fixed bottom-24 right-6 bg-indigo-600 text-white w-14 h-14 rounded-2xl shadow-2xl flex items-center justify-center active:scale-90 transition-transform z-50">
            <i data-lucide="plus" class="w-8 h-8"></i>
        </button>
    </div>

    <script>
        const { createApp, ref, computed, onMounted, watch, nextTick } = Vue;
        createApp({
            setup() {
                const currentDayIndex = ref(0);
                const itineraryData = ref([{ id: 1, items: [] }]);

                const sortedItems = computed(() => {
                    const day = itineraryData.value[currentDayIndex.value];
                    if (!day) return [];
                    return day.items.slice().sort((a, b) => timeToMin(a.start) - timeToMin(b.start));
                });

                onMounted(() => {
                    const saved = localStorage.getItem('tokyo_beauty_v1');
                    if (saved) itineraryData.value = JSON.parse(saved);
                    lucide.createIcons();
                });

                watch(itineraryData, () => {
                    localStorage.setItem('tokyo_beauty_v1', JSON.stringify(itineraryData.value));
                    nextTick(() => lucide.createIcons());
                }, { deep: true });

                const timeToMin = (t) => {
                    const [h, m] = t.split(':').map(Number);
                    return h * 60 + m;
                };

                const formatMin = (min) => min < 60 ? `${min}m` : `${Math.floor(min/60)}h${min%60}m`;
                const getGap = (prev, curr) => timeToMin(curr.start) - timeToMin(prev.end);

                const addItem = () => {
                    const last = sortedItems.value[sortedItems.value.length - 1];
                    const start = last ? last.end : '09:00';
                    const end = last ? minToTime(timeToMin(start) + 60) : '10:00';
                    itineraryData.value[currentDayIndex.value].items.push({
                        id: Date.now(), title: '', start, end, category: 'activity', subType: 'walk', details: ''
                    });
                };

                const minToTime = (min) => `${String(Math.floor(min/60)%24).padStart(2,'0')}:${String(min%60).padStart(2,'0')}`;
                const removeItem = (id) => {
                    const idx = itineraryData.value[currentDayIndex.value].items.findIndex(i => i.id === id);
                    itineraryData.value[currentDayIndex.value].items.splice(idx, 1);
                };
                const addDay = () => {
                    itineraryData.value.push({ id: Date.now(), items: [] });
                    currentDayIndex.value = itineraryData.value.length - 1;
                };

                return { currentDayIndex, itineraryData, sortedItems, addItem, removeItem, addDay, getGap, formatMin };
            }
        }).mount('#app');
    </script>
</body>
</html>
